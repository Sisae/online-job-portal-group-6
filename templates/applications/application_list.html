{% extends 'base.html' %}

{% block title %}Job Applications - Job Portal{% endblock %}

{% block content %}
<div>
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-3xl font-bold text-foreground-light dark:text-foreground-dark">Job Applications</h2>
        <div id="filter-buttons" class="flex flex-wrap gap-2">
            <button data-status="all" class="filter-btn active-filter px-4 py-2 text-sm font-semibold rounded-lg">All</button>
            <button data-status="applied" class="filter-btn px-4 py-2 text-sm font-semibold rounded-lg">Applied</button>
            <button data-status="under_review" class="filter-btn px-4 py-2 text-sm font-semibold rounded-lg">Under Review</button>
            <button data-status="interview" class="filter-btn px-4 py-2 text-sm font-semibold rounded-lg">Interview</button>
            <button data-status="offered" class="filter-btn px-4 py-2 text-sm font-semibold rounded-lg">Offer</button>
            <button data-status="rejected" class="filter-btn px-4 py-2 text-sm font-semibold rounded-lg">Rejected</button>
        </div>
    </div>
    
    {% if applications %}
        <div id="applications-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for application in applications %}
                <div class="application-card bg-card-light dark:bg-card-dark rounded-lg shadow-md p-5 flex flex-col" data-status="{{ application.status }}">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg text-foreground-light dark:text-foreground-dark">{{ application.applicant.get_full_name|default:application.applicant.username }}</h3>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full 
                            {% if application.status == 'applied' %}bg-blue-100 text-blue-800
                            {% elif application.status == 'under_review' %}bg-yellow-100 text-yellow-800
                            {% elif application.status == 'interview' %}bg-purple-100 text-purple-800
                            {% elif application.status == 'offered' %}bg-green-100 text-green-800
                            {% elif application.status == 'rejected' %}bg-red-100 text-red-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ application.get_status_display }}
                        </span>
                    </div>
                    
                    <p class="text-sm text-muted-light dark:text-muted-dark mb-4">
                        Applied for: <span class="font-semibold">{{ application.job.title }}</span>
                    </p>
                    
                    <div class="flex-grow"></div>

                    <div class="text-xs text-muted-light dark:text-muted-dark mb-4">
                        Applied {{ application.applied_date|timesince }} ago
                    </div>
                    
                    <div class="flex justify-between items-center gap-2">
                        <a href="{% url 'applications:application_detail' application.id %}" class="flex-1 text-center px-4 py-2 text-sm font-semibold rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">View Details</a>
                        <a href="{% url 'applications:application_status_update' application.id %}" class="flex-1 text-center px-4 py-2 text-sm font-semibold rounded-lg bg-primary/10 text-primary hover:bg-primary/20 transition-colors">Update Status</a>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if is_paginated %}
            <nav aria-label="Application pagination" class="mt-8">
                <ul class="flex justify-center items-center gap-2">
                    {% if page_obj.has_previous %}
                        <li><a href="?page=1" class="px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">&laquo; First</a></li>
                        <li><a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">Previous</a></li>
                    {% endif %}
                    
                    <li class="px-3 py-2 text-sm rounded-lg bg-primary/10 text-primary">
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                    </li>
                    
                    {% if page_obj.has_next %}
                        <li><a href="?page={{ page_obj.next_page_number }}" class="px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">Next</a></li>
                        <li><a href="?page={{ page_obj.paginator.num_pages }}" class="px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">Last &raquo;</a></li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    {% else %}
        <div class="text-center py-16 bg-card-light dark:bg-card-dark rounded-lg">
            <span class="material-symbols-outlined text-6xl text-muted-light dark:text-muted-dark mb-4">folder_off</span>
            <h3 class="text-2xl font-bold text-foreground-light dark:text-foreground-dark">No Applications Found</h3>
            <p class="text-muted-light dark:text-muted-dark mt-2">No applications have been submitted for your jobs yet.</p>
            <a href="{% url 'jobs:job_create' %}" class="mt-6 inline-block px-6 py-2 text-sm font-semibold rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">Post a Job</a>
        </div>
    {% endif %}
</div>

<style>
.filter-btn {
    background-color: #e5e7eb; /* bg-gray-200 */
    color: #374151; /* text-gray-700 */
}
.dark .filter-btn {
    background-color: #374151; /* dark:bg-gray-700 */
    color: #f9fafb; /* dark:text-gray-50 */
}
.filter-btn.active-filter {
    background-color: #1173d4; /* bg-primary */
    color: #ffffff; /* text-white */
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.getElementById('filter-buttons');
    const applicationCards = document.querySelectorAll('.application-card');

    if (filterButtons) {
        filterButtons.addEventListener('click', function(event) {
            if (event.target.matches('.filter-btn')) {
                const status = event.target.dataset.status;

                // Update active button
                filterButtons.querySelector('.active-filter').classList.remove('active-filter');
                event.target.classList.add('active-filter');

                // Filter cards
                applicationCards.forEach(card => {
                    if (status === 'all' || card.dataset.status === status) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        });
    }
});
</script>
{% endblock %}

{% extends 'base.html' %}

{% block title %}
    {% if user.is_authenticated %}
        Dashboard - {{ block.super }}
    {% else %}
        Welcome - {{ block.super }}
    {% endif %}
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
    {% if user.profile.user_type == 'employer' %}
        {# Authenticated Employer Dashboard #}
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Welcome Banner -->
                <div class="bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800/50 text-primary-700 dark:text-primary-300 p-6 rounded-lg">
                    <h1 class="text-2xl font-bold">Welcome back, {{ user.first_name|default:user.username }}!</h1>
                    <p class="mt-1">Here's a summary of your employer activity.</p>
                </div>

                <!-- Recent Job Postings -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">Your Recent Job Postings</h3>
                        <a href="{% url 'jobs:my_jobs' %}" class="text-sm font-semibold text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300">View All Jobs</a>
                    </div>
                    <div class="p-6">
                        {% if recent_jobs %}
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {% for job in recent_jobs %}
                                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="font-bold text-gray-800 dark:text-gray-200">{{ job.title }}</h4>
                                            <span class="px-2 py-0.5 text-xs font-semibold rounded-full {% if job.is_active %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200{% else %}bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300{% endif %}">
                                                {% if job.is_active %}Active{% else %}Inactive{% endif %}
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
                                            <span class="material-symbols-outlined text-base">location_on</span>
                                            {{ job.location }}
                                        </p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                            {{ job.get_job_type_display }} &bull; Posted {{ job.posted_date|timesince }} ago
                                        </p>
                                        <div class="flex justify-between items-center mt-4">
                                            <a href="{% url 'jobs:job_detail' job.slug %}" class="text-sm font-semibold text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300">View Details</a>
                                            <p class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
                                                <span class="material-symbols-outlined text-base">group</span>
                                                {{ job.applications.count }}
                                            </p>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-8">
                                <span class="material-symbols-outlined text-5xl text-gray-400 dark:text-gray-500 mb-3">work_off</span>
                                <h4 class="font-semibold text-gray-800 dark:text-gray-200">No jobs posted yet</h4>
                                <p class="text-gray-500 dark:text-gray-400 mt-1">Start by posting your first job opening.</p>
                                <a href="{% url 'jobs:job_create' %}" class="mt-4 inline-block px-6 py-2 text-sm font-semibold rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors">Post Your First Job</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Quick Stats -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Quick Stats</h4>
                    <ul class="space-y-3 text-gray-700 dark:text-gray-300">
                        <li class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">work</span> {{ total_jobs }} Total Jobs Posted</li>
                        <li class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">group</span> {{ total_applications }} Total Applications</li>
                        <li class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">pending_actions</span> {{ pending_applications }} Pending Reviews</li>
                    </ul>
                </div>
                
                <!-- Application Status -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Application Status Breakdown</h4>
                    <div class="grid grid-cols-2 gap-3 text-center text-sm">
                        <div class="bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200 p-2 rounded-lg">{{ under_review }} Under Review</div>
                        <div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200 p-2 rounded-lg">{{ interviews }} Interviews</div>
                        <div class="bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200 p-2 rounded-lg">{{ offers }} Offers</div>
                        <div class="bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-200 p-2 rounded-lg">{{ rejected }} Rejected</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Quick Actions</h4>
                    <div class="flex flex-col gap-3">
                        <a href="{% url 'jobs:job_create' %}" class="w-full text-center px-4 py-2 text-sm font-semibold rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors">Post a New Job</a>
                        <a href="{% url 'applications:application_list' %}" class="w-full text-center px-4 py-2 text-sm font-semibold rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Review Applications</a>
                        <a href="{% url 'companies:my_company' %}" class="w-full text-center px-4 py-2 text-sm font-semibold rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Manage Company Profile</a>
                    </div>
                </div>
            </div>
        </div>
    {% elif user.profile.user_type == 'job_seeker' %}
        {# Authenticated Seeker Dashboard #}
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Welcome Banner -->
                <div class="bg-secondary-50 dark:bg-secondary-900/20 border border-secondary-200 dark:border-secondary-800/50 text-secondary-700 dark:text-secondary-300 p-6 rounded-lg">
                    <h1 class="text-2xl font-bold">Welcome back, {{ user.first_name|default:user.username }}!</h1>
                    <p class="mt-1">Your job search journey starts here. Let's find your next role.</p>
                </div>

                <!-- Recent Applications -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">Your Recent Applications</h3>
                        <a href="{% url 'applications:my_applications' %}" class="text-sm font-semibold text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300">View All Applications</a>
                    </div>
                    <div class="p-6">
                        {% if recent_applications %}
                            <ul class="space-y-4">
                                {% for application in recent_applications %}
                                    <li class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-700">
                                        <div>
                                            <a href="{% url 'jobs:job_detail' application.job.slug %}" class="font-semibold text-gray-800 dark:text-gray-200 hover:text-primary-600 dark:hover:text-primary-400">{{ application.job.title }}</a>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ application.job.company.name }}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full 
                                                {% if application.status == 'applied' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
                                                {% elif application.status == 'under_review' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200
                                                {% elif application.status == 'interview' %}bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200
                                                {% elif application.status == 'offer' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
                                                {% elif application.status == 'rejected' %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200
                                                {% endif %}">
                                                {{ application.get_status_display }}
                                            </span>
                                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">{{ application.applied_date|timesince }} ago</p>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="text-center py-8">
                                <span class="material-symbols-outlined text-5xl text-gray-400 dark:text-gray-500 mb-3">search</span>
                                <h4 class="font-semibold text-gray-800 dark:text-gray-200">No applications yet</h4>
                                <p class="text-gray-500 dark:text-gray-400 mt-1">Start your job search and apply for a position.</p>
                                <a href="{% url 'jobs:job_list' %}" class="mt-4 inline-block px-6 py-2 text-sm font-semibold rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors">Find Jobs</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Application Stats -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Your Application Stats</h4>
                    <ul class="space-y-3 text-gray-700 dark:text-gray-300">
                        <li class="flex items-center justify-between"><span class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">send</span> Total Submitted</span> <span class="font-bold">{{ total_applications_submitted }}</span></li>
                        <li class="flex items-center justify-between"><span class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">visibility</span> Under Review</span> <span class="font-bold">{{ under_review_count }}</span></li>
                        <li class="flex items-center justify-between"><span class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">question_answer</span> Interviews</span> <span class="font-bold">{{ interview_count }}</span></li>
                        <li class="flex items-center justify-between"><span class="flex items-center gap-3"><span class="material-symbols-outlined text-xl text-gray-500 dark:text-gray-400">workspace_premium</span> Offers</span> <span class="font-bold">{{ offer_count }}</span></li>
                    </ul>
                </div>

                <!-- Suggested Jobs -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100">Jobs You Might Like</h4>
                    </div>
                    <div class="p-6">
                        {% if suggested_jobs %}
                            <ul class="space-y-4">
                                {% for job in suggested_jobs %}
                                    <li class="p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-700">
                                        <a href="{% url 'jobs:job_detail' job.slug %}" class="font-semibold text-gray-800 dark:text-gray-200 hover:text-primary-600 dark:hover:text-primary-400">{{ job.title }}</a>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">{{ job.company.name }} - {{ job.location }}</p>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">No new job suggestions right now.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% else %}
    {# Unauthenticated User Homepage #}
    <!-- Hero Section with Background -->
    <section class="relative -mx-4 sm:-mx-6 lg:-mx-8 -mt-8">
        <div class="absolute inset-0 bg-cover bg-center" style='background-image: linear-gradient(rgba(16, 25, 34, 0.5) 0%, rgba(16, 25, 34, 0.8) 100%), url("https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?w=1600&q=80");'></div>
        <div class="relative px-4 sm:px-6 lg:px-8 py-32 sm:py-40 text-center text-white">
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight">Find the right job or internship for you</h1>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-200">Search from thousands of job openings and internships to find the perfect fit for your career goals.</p>
            <div class="mt-8 max-w-xl mx-auto">
                <form action="{% url 'jobs:job_list' %}" method="get" class="relative">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-slate-400" fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                            <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
                        </svg>
                    </div>
                    <input class="w-full h-14 pl-12 pr-32 rounded-lg bg-white/90 text-slate-900 placeholder-slate-500 focus:ring-2 focus:ring-blue-600 focus:outline-none transition-all" 
                           name="search" 
                           placeholder="Search job titles or companies" 
                           type="search"/>
                    <button class="absolute inset-y-0 right-0 m-2 flex items-center justify-center h-10 px-6 rounded-lg bg-blue-600 text-white text-sm font-bold hover:bg-blue-700 transition-colors" type="submit">
                        Search
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Featured Job Categories -->
    <section class="py-16 sm:py-24 bg-gray-50">
        <div class="px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold tracking-tight text-center text-gray-900">Featured Job Categories</h2>
            <div class="mt-12 grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6">
                <a class="group block" href="{% url 'jobs:job_list' %}?search=Software">
                    <div class="aspect-square w-full overflow-hidden rounded-xl bg-gradient-to-br from-blue-500 to-purple-600">
                        <div class="h-full w-full flex items-center justify-center text-white text-4xl font-bold">ðŸ’»</div>
                    </div>
                    <p class="mt-3 text-base font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">Software Engineering</p>
                </a>
                <a class="group block" href="{% url 'jobs:job_list' %}?search=Data">
                    <div class="aspect-square w-full overflow-hidden rounded-xl bg-gradient-to-br from-green-500 to-teal-600">
                        <div class="h-full w-full flex items-center justify-center text-white text-4xl font-bold">ðŸ“Š</div>
                    </div>
                    <p class="mt-3 text-base font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">Data Science</p>
                </a>
                <a class="group block" href="{% url 'jobs:job_list' %}?search=Marketing">
                    <div class="aspect-square w-full overflow-hidden rounded-xl bg-gradient-to-br from-pink-500 to-rose-600">
                        <div class="h-full w-full flex items-center justify-center text-white text-4xl font-bold">ðŸ“±</div>
                    </div>
                    <p class="mt-3 text-base font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">Marketing</p>
                </a>
                <a class="group block" href="{% url 'jobs:job_list' %}?search=Product">
                    <div class="aspect-square w-full overflow-hidden rounded-xl bg-gradient-to-br from-yellow-500 to-orange-600">
                        <div class="h-full w-full flex items-center justify-center text-white text-4xl font-bold">ðŸš€</div>
                    </div>
                    <p class="mt-3 text-base font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">Product Management</p>
                </a>
                <a class="group block" href="{% url 'jobs:job_list' %}?search=Sales">
                    <div class="aspect-square w-full overflow-hidden rounded-xl bg-gradient-to-br from-indigo-500 to-blue-600">
                        <div class="h-full w-full flex items-center justify-center text-white text-4xl font-bold">ðŸ’¼</div>
                    </div>
                    <p class="mt-3 text-base font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">Sales</p>
                </a>
                <a class="group block" href="{% url 'jobs:job_list' %}?search=Customer">
                    <div class="aspect-square w-full overflow-hidden rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600">
                        <div class="h-full w-full flex items-center justify-center text-white text-4xl font-bold">ðŸŽ§</div>
                    </div>
                    <p class="mt-3 text-base font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">Customer Service</p>
                </a>
            </div>
        </div>
    </section>

    <!-- CTA Section for Job Seekers -->
    <section class="py-16 sm:py-24 bg-white">
        <div class="px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl font-bold tracking-tight text-gray-900">Looking for a job?</h2>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">Explore thousands of job openings across various industries and locations. Find your dream job today!</p>
            <div class="mt-8">
                <a class="inline-flex items-center justify-center h-12 px-8 rounded-lg bg-blue-600 text-white text-base font-bold hover:bg-blue-700 transition-colors shadow-lg" 
                   href="{% url 'jobs:job_list' %}">
                    Find Jobs
                </a>
            </div>
        </div>
    </section>

    <!-- CTA Section for Employers -->
    <section class="py-16 sm:py-24 bg-gray-50">
        <div class="px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl font-bold tracking-tight text-gray-900">Hiring? Find the best talent.</h2>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">Connect with qualified candidates and fill your open positions quickly and efficiently.</p>
            <div class="mt-8">
                <a class="inline-flex items-center justify-center h-12 px-8 rounded-lg bg-blue-600 text-white text-base font-bold hover:bg-blue-700 transition-colors shadow-lg" 
                   href="{% url 'accounts:signup' %}">
                    Post a Job
                </a>
            </div>
        </div>
    </section>
{% endif %}
{% endblock %}

